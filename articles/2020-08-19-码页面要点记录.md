# 码页面要点记录

## 响应链相关

我之前写过相关文章 [iOS中事件的响应和传递](./articles/2020-5-27-iOS中事件的响应和传递.md) 可以先看看

**1 穿透触发事件**，比如：需要点击选中 view 触发事件。那么就需要**穿透**在选中 view 之上的 view

![image-20200819111707046](../assets/image-20200819111707046.png)



实现：在目标父 view 重写 `- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event;` 方法

```objective-c
- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {
    if (!self.userInteractionEnabled || [self isHidden] || self.alpha <= 0.1) {
        return nil;
    }
    if ([self pointInside: point withEvent: event]) {
        __block UIView *hit = nil;
        [self.subviews enumerateObjectsWithOptions: NSEnumerationReverse usingBlock:^(__kindof UIView * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
            // 隐藏view直接跳出本次循环
            if (obj.hidden) {
                return;
            }
          	// 坐标转换
            CGPoint currentPoint = [self convertPoint: point toView: obj];
          	// 递归调用
            hit = [obj hitTest: currentPoint withEvent: event];
            // 透传目标点击事件
            CGPoint aimViewPoint = [obj convertPoint:currentPoint toView:self.container];
            if (CGRectContainsPoint(self.aimView.frame, aimViewPoint)) {
                hit = self.aimView;
            }
            // 命中退出循环
            if (hit) {
                *stop = YES;
            }
            
        }];
        
        if (hit) {
            return hit;
        } else {
            return self;
        }
    } else {
        return nil;
    }
}
```



**2 超出父 view 的 frame，触发事件**。比如：要拖动超出父 view 的 slider 



![image-20200819112257418](../assets/image-20200819112257418.png)



实现：重写 slider 父 view 的  `- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event;` 方法

```objective-c
- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {
  	// slider 在所在view父视图的frame
    CGRect frameInSuper = [self convertRect:self.slider.frame toView: self.superview];
    if ((!self.slider.hidden) && CGRectContainsPoint(frameInSuper, point)) {
        return self.slider.hidden;
    }
    return [super hitTest:point withEvent:event];
}

```



## Gesture 手势相关

遇到的问题是：iOS 13 在给 view 添加了 swipe 手势后，页面上的 slider 滑动**不跟手**。

解决：给 slider 添加了一个无效的 pan 手势

```objective-c
// target nil / action NULL
UIPanGestureRecognizer *panGesture = [[UIPanGestureRecognizer alloc] initWithTarget:nil action:NULL];
panGesture.cancelsTouchesInView = false;
[_slider addGestureRecognizer:panGesture];
```




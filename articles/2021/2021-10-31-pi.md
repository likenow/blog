## 树莓派



### 安装系统

#### 1. 格式化 TF 卡

SD Card Formatter Version 5.0.1格式化TF卡。这种方式刷卡，慢的要死。。。

<img src="/Users/kaili/Library/Application Support/typora-user-images/image-20211031101859607.png" alt="image-20211031101859607" style="zoom:50%;" />

<img src="../../assets/image-20211031142758009.png" alt="image-20211031142758009" style="zoom:50%;" />

<img src="../../assets/image-20211031142927739.png" alt="image-20211031142927739" style="zoom:50%;" />



#### 2. 烧录系统 Ubuntu Server 20.04 TS

<img src="../../assets/image-20211031143122549.png" alt="image-20211031143122549" style="zoom:50%;" />

<img src="../../assets/image-20211031143139793.png" alt="image-20211031143139793" style="zoom:50%;" />



<img src="../../assets/image-20211031143250100.png" alt="image-20211031143250100" style="zoom:50%;" />

<img src="../../assets/image-20211031143535573.png" alt="image-20211031143535573" style="zoom:50%;" />

<img src="../../assets/image-20211031143740671.png" alt="image-20211031143740671" style="zoom:50%;" />

<img src="../../assets/image-20211031143839372.png" alt="image-20211031143839372" style="zoom:50%;" />





<img src="../../assets/image-20211031150617773.png" alt="image-20211031150617773" style="zoom:50%;" />

上图情况，需要删除 .ssh/know_host 下的那条记录。



<img src="../../assets/image-20211031145038264.png" alt="image-20211031145038264" style="zoom:50%;" />

<img src="../../assets/image-20211031145139933.png" alt="image-20211031145139933" style="zoom:50%;" />

<img src="../../assets/image-20211031153650902.png" alt="image-20211031153650902" style="zoom:50%;" />





### 3 安装 docker

如果你过去安装过 docker，先删掉:

```bash
sudo apt-get remove docker docker-engine docker.io
```

首先安装依赖:

```bash
sudo apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common
```

根据你的发行版，下面的内容有所不同。你使用的发行版： Debian Ubuntu

信任 Docker 的 GPG 公钥:

```bash
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
```

对于 amd64 架构的计算机，添加软件仓库:



```bash
sudo add-apt-repository \
   "deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \
   $(lsb_release -cs) \
   stable"
```

如果你是树莓派或其它 ARM 架构计算机，请运行:



```bash
echo "deb [arch=armhf] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \
     $(lsb_release -cs) stable" | \
    sudo tee /etc/apt/sources.list.d/docker.list
```

最后安装

```bash
sudo apt-get update
sudo apt-get install docker-ce
```



#### 3.1 安装 homeassistant

```bash
docker run -d \
  --name homeassistant \
  --privileged \
  --restart=unless-stopped \
  -e TZ=MY_TIME_ZONE \
  -v /PATH_TO_YOUR_CONFIG:/config \
  --network=host \
  ghcr.io/home-assistant/home-assistant:stable
```

<img src="../../assets/image-20211031223631947.png" alt="image-20211031223631947" style="zoom:50%;" />

Ps.

期间忘了密码，首先找到

 `sudo docker inspect 容器id`

`sudo docker exec -it 容器id /bin/bash  `

然后进行命令行操作 删除 `.storage` 文件即可



#### 3.2 安装smb

创建一个文件夹

```bash
sudo mkdir /opt/smb
sudo chmod -R 777 /opt/smb
```

安装smb服务

```bash
sudo apt update
sudo apt install samba -y
```

创建smb密码文件

```bash
sudo touch /etc/samba/smbpasswd
```

添加用户并设置密码

```bash
sudo smbpasswd -a ubuntu
```

在`/etc/samba/smb.conf` 中添加如下配置

```bash
[ubuntu]
   comment = ubuntu
   path = /opt/smb
   writable = yes
   valid user = ubuntu
   available = yes
   create mask = 0777
   directory mask = 0777
   public = yes
```

重启smb服务

```bash
sudo /etc/init.d/smbd restart
```

挂载外接u盘

在`/opt/smb/` 下新建文件夹 `upan1`， 作为挂载点

```bash
sudo mkdir  /opt/smb/upan1
sudo chmod 777 -R  /opt/smb/upan1
```

接入硬盘，查看硬盘是否接入成功

```bash
sudo fdisk -l
```

可以看到设备挂载的位置为 `/dev/sdc`

- 挂载硬盘

```
sudo mount /dev/sdc /opt/smb/upan1
sudo chmod 777 -R  /opt/smb/upan1
```

<img src="../../assets/image-20211031222542949.png" alt="image-20211031222542949" style="zoom:50%;" />



##### 在Mac上挂载使用smb

- 连接服务器

<img src="../../assets/image-20211031222007197.png" alt="image-20211031222007197" style="zoom:50%;" />





### 参考

- [树莓派乌金甲外壳安装教程](https://www.bilibili.com/video/BV1yE411y79q?from=search&seid=14416903231749814923&spm_id_from=333.337.0.0)
- [Ubuntu安装 Docker ](https://docs.docker.com/engine/install/ubuntu/)


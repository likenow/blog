---
title: 敲代码时遇到的乱码问题
date: 2015-04-24 9:59:51
categories:
- 编码
tags:
- Unicode/UCS
- UTF
- GBK
- 乱码
---
## 写在前面的话

做编程这一行当然免不了要敲代码，作为国内的编程人员，乱码一直更是让人头疼的问题，经常出现中文乱码的问题，试想**程序猿**辛辛苦苦敲出来的代码呈现出来的却是些乱七八糟的东西，这怎能不让人吐槽！！！接下来，我对编码做一个彻底解释！对乱码的产生及解决做一下记录，如果你遇到了类似的问题，那就要仔细的看看这篇文章。
<!--more-->

## 字符编码

### 字符编码趣谈

开始人类用8个可以开合的*晶体管*来组合成不同的状态，以表示世界上的万物，他们把这称为**字节**。后来，人类又做了一些可以处理这些字节以及用字节来组合出的很多状态的机器——计算机。开始计算机只在美利坚，八位的字节一共可以组合出256(2的8次方)种不同的状态。美利坚人把其中的编号从0开始的32种状态分别规定了特殊的用途，一但终端、打印接收到约定好的这些字节被传过来时，就要做一些约定的动作。比如，遇上 00×10, 终端就换行，遇上 0×07 , 终端就向人们嘟嘟叫。美利坚人把这些 0×20 以下的字节状态称为**控制码**。他们又把所有的空格、标点符号、数字、大小写字母分别用连续的字节状态表示，一直编到了第127号，这样计算机就可以用不同字节来存储英语的文字 了。人们把这个方案叫做 ANSI 的 ASCII 编码（American Standard Code for Information Interchange，美国信息互换标准代码）。当时世界上所有的计算机都用同样的**ASCII方案**来保存英文字母。

后来计算机发展越来越广泛，世界各国为了可以在计算机保存他们的文字，他们决定采用127号之后的空位来表示这些新的字母、符号，还加入了很多画表格时需要用下到的横线、竖线、交叉等形状，一直把序号编到了最后一个状态255。从128到255这一页的字符集被称**扩展字符集**。但是原有的编号方法，已经再也放不下更多的编码。

等中国人民想使用计算机做点事儿的时候，已经没有可以利用的字节状态来表示汉字，况且有6000多个常用汉字需要保存呢？于是国人就自主研发，把那些127号之后的奇异符号们直接取消掉，**并规定：一个小于127的字符的意义与原来相同，但两个大于127的字符连在一起时，就表示一个汉字，前面的一个字节（他称之为高字节）从 0xA1 用到 0xF7 ，后面一个字节（低字节）从 0xA1 到 0xFE ，这样我们就可以组合出大约7000多个简体汉字了。**在这些编码里，我们还把数学符号、罗马希腊的字母、日文的假名们都编进去了，连在 ASCII 里本来就有的数字、标点、字母都统统重新编了两个字节长的编码，这就是常说的**全角**字符，而原来在127号以下的那些就叫**半角**字符了。中国人民看到这样很不错，于是就把这种汉字方案叫做 GB2312 。 GB2312 是对 **ASCII 的中文扩展**。但是中国的汉字太多了，后来还是不够用，于是干脆不再要求低字节一定是127号之后的内码，只要第一个字节是大于127就固定表示这是一个汉字的开始，不管后面跟的是不是 扩展字符集里的内容。结果扩展之后的编码方案被称为 GBK 标准，GBK 包括了 GB2312 的所有内容，同时又增加了近20000个新的汉字（包括繁体字）和符号。后来少数民族也要用电脑了，于是我们再扩展，又加了几千个新的少数民族的字，**GBK 扩成了 GB18030**。

因为当时各个国家都像中国这样搞出一套自己的编码标准，结果互相之间谁也不懂谁的编码，谁也不支持别人的编码。当时的中国人想让电脑显示汉字，就必须装上一个”汉字系统”，专门用来处理汉字的显示、输入的问题，装错了字符系统，显示就会乱了套。这怎么办？

就在这时，一个叫 **ISO** （国际标谁化组织）的国际组织决定着手解决这个问题。他们采用的方法很简单：废了所有的地区性编码方案，重新搞一个包括了地球上所有文化、所有字母和符号的编码！他们打算叫它**Universal Multiple-Octet Coded Character Set**，简称 **UCS**, 俗称 UNICODE 。**UNICODE** 开始制订时，计算机的存储器容量极大地发展了，空间再也不成为问题了。于是 ISO 就直接规定必须用两个字节，也就是16位来统一表示所有的字符，对于 ASCII 里的那些*半角*字符，UNICODE 包持其原编码不变，只是将其长度由原来的8位扩展为16位，而其他文化和语言的字符则全部重新统一编码。由于*半角*英文符号只需要用到低8位，所以其高 8位永远是0，因此这种阔气的方案在保存英文文本时会多浪费一倍的空间。**UNICODE **是用两个字节来表示为一个字符，他总共可以组合出65535不同的字符，这大概已经可以覆盖世界上所有文化的符号。

**UNICODE** 来到时，一起到来的还有计算机网络的兴起，UNICODE 如何在网络上传输也是一个必须考虑的问题，于是面向传输的众多 **UTF（UCS Transfer Format）**标准出现了，顾名思义，UTF8 就是每次8个位传输数据，而 **UTF16** 就是每次16个位，只不过为了传输时的可靠性，从 UNICODE 到  UTF 时并不是直接的对应，而是要过一些算法和规则来转换。这种转换，这里就不再赘述了。

### 简单的总结

关于**字符集**（character set）和**编码（encoding）**，对于 ASCII、GB 2312、Big5、GBK、GB 18030 之类的遗留方案来说，基本上一个字符集方案只使用一种编码方案。比如 ASCII 这部标准本身就直接规定了字符和字符编码的方式，所以既是字符集又是编码方案；而 GB 2312 只是一个区位码形式的字符集标准，不过实际上基本都用 EUC-CN 来编码，所以提及「GB 2312」时也说的是一个**字符集和编码连锁的方案**；GBK 和 GB 18030 等向后兼容于 GB 2312 的方案也类似。
对于 Unicode，字符集和编码是明确区分的。Unicode/UCS 标准首先是个统一的字符集标准。而 Unicode/UCS 标准同时也定义了几种可选的编码方案，在标准文档中称作「encoding form」，主要包括 UTF-8、UTF-16 和 UTF-32。所以，对 Unicode 方案来说，同样的基于 Unicode 字符集的文本可以用多种编码来存储、传输。所以，用「Unicode」来称呼一个编码方案不合适，并且误导。

## 乱码产生原因及解决

### 乱码的产生

以 Windows 为例，Windows 里说的「ANSI」其实是 Windows code pages，这个模式根据当前 locale 选定具体的编码，比如简体中文 locale 下是 GBK。我们可以看一下进入 DOS 窗口输入： **chcp** 可以得到操作系统的代码页信息，你可以从控制面板的语言选项中查看代码页对应的详细的字符集信息。我查的活动代码页为：936，它对应的编码为 GBK 。当你在 windows 系统下编写完代码保存的时候，一般会保存为系统默认的编码格式，这样一来如果你的代码源文件编码格式与你的编译器所解析的编码格式不同当然就会报错了。

### 解决方法

这个问题不难解决，你在保存代码文件的时候选择保存为编译器能够解析的格式就通过编译了。但是你会发现，编译出来运行一下发现控制台显示的依然是乱码！！！Why？那是因为控制台显示的时候缺省的是使用系统默认的字符集，中国在 windows 下的话默认 GBK ，编译之后的可执行文件假设是 UTF-8 的，系统会以识别GBK一样对待 UTF-8 当然会出现**乱码**了！

搞懂了乱码产生的原因，那么不难得找到解决问题的办法，你想修改成什么格式的都OK，关键是要**统一**，并不是像网上一些人说的，修改成 GBK 啦，修改成UTF-8啦，其实关键是你自己要知道自己在干什么。涉及兼容性考量时，不要用记事本，用专业的文本编辑器保存为不带 BOM 的 UTF-8。我用的是 **Sublime Text3**，挺好用的而且基本上没再遇到过乱码问题。 明白了其中的原理就 OK！！！


## 写在最后的话

花了一个晚上的时间终于算是总结的差不多了，文中出现的专业术语都是参考资料确认过的，另外文章中也有大段的引用，在文章的最后也列出了参考文献，**感谢**他们的智慧成果！通过以上的字符编码分析，乱码的产生以及如何解决乱码，于我个人而言有了一个更为清晰的认识，于我的读者而言希望我的博文可以给看到文章最后的您带来些许的帮助，谢谢！在接下来的学习中我会不断的总结知识，然后记录到博客上来，敬请期待！

## 参考文献

- [字符编码](http://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81)
- [16进制与2进制10进制对照表](http://www.doc88.com/p-507834784123.html)
- [ASCII码](http://akaedu.github.io/book/apas01.html)
- [Unicode和UTF-8](http://akaedu.github.io/book/apas02.html)
- [中文乱码问题](http://huangshanghua.iteye.com/blog/1689134)
- [中文乱码问题及其解决方法](http://blog.csdn.net/tkd03072010/article/details/6667689)
- [网页编码就是那点事](http://www.qianxingzhem.com/post-1499.html)
- [C/C++ 编程中多国语言处理](https://www.ibm.com/developerworks/cn/linux/l-cn-ccppglb/)
- [ANSI控制码](http://www.cnblogs.com/hbt19860104/archive/2012/08/07/2627130.html)
- [乱码形成原因及消除方法大全 ](http://blog.chinaunix.net/uid-20611305-id-321419.html)
- [Code：Blocks 中文乱码问题原因分析和解决方法！](http://blog.csdn.net/softman11/article/details/6121538)
- [http://blog.sina.com.cn/s/blog_463b79ca010124k8.html](http://blog.sina.com.cn/s/blog_463b79ca010124k8.html)
- [Windows 记事本的 ANSI、Unicode、UTF-8 这三种编码模式有什么区别？](http://www.zhihu.com/question/20650946)
- [Code：:Blocks 中文乱码问题原因分析和解决方法](http://blog.csdn.net/skypegnu/article/details/9155499)
- [关于字符编码，你所需要知道的（ASCII,Unicode,Utf-8,GB2312…）](http://www.imkevinyang.com/2010/06/%E5%85%B3%E4%BA%8E%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%EF%BC%8C%E4%BD%A0%E6%89%80%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84.html)
- [字符编解码的故事（ASCII，ANSI，Unicode，Utf-8区别）](http://www.imkevinyang.com/2009/02/%E5%AD%97%E7%AC%A6%E7%BC%96%E8%A7%A3%E7%A0%81%E7%9A%84%E6%95%85%E4%BA%8B%EF%BC%88ascii%EF%BC%8Cansi%EF%BC%8Cunicode%EF%BC%8Cutf-8%E5%8C%BA%E5%88%AB%EF%BC%89.html)
---
title: C语言学习笔记内联函数
date: 2014-08-16 22:23:52
categories:
- C
tags:
- 内联函数
- inline
- C
---

从维基百科[内联函数](https://zh.wikipedia.org/wiki/%E5%86%85%E8%81%94%E5%87%BD%E6%95%B0)，的解释可以看出。函数调用，实际上将程序执行顺序转移到函数所存放在内存中某个地址，将函数的程序内容执行完后，再返回到转去执行该函数前的地方。这种转移操作要求在转去前要保留当前的上下文记录函数执行的地址，转回后先要恢复上下文，并按原来保存地址继续执行。

因此，函数调用要有一定的**时间**和**空间**方面的开销，将影响其效率。特别是对于一些函数体代码不是很大，但又频繁地被调用的函数来讲，解决其效率问题更为重要。引入**内联函数**实际上就是为了解决这上述问题。

在程序编译时，编译器将程序中出现的内联函数的调用表达式用内联函数的函数体来进行替换。显然，这种做法不会产生转去转回的问题，但是由于在编译时将函数休中的代码被替代到程序中，因此会增加目标程序代码量，进而增加空间开销，而在时间代销上不象函数调用时那么大，可见它是以目标代码的增加为代价来换取时间的节省。

<!--more-->

## 内联函数定义

**C99引入关键字`inline`定义内联函数。inline 必须与函数定义体放在一起才能使函数成为内联，仅将inline 放在函数声明前面不起任何作用**。内联函数在编译时被替代，而不是像一般函数那样是在运行时被调用。

### 函数外通过 inline 关键字定义的函数
```c
inline int Sum(int x, int y); // inline 仅与函数声明放在一起，错误
int Sum(int x, int y) {
	return (x + y);
}
```

```c
void Sum(int x, int y);
inline void Sum(int x, int y) { // inline 与函数定义体放在一起，正确
	return (x + y);
}
```

```c
void main() {  
	int a = 1;
    int b = 2;
	int c = Sum(a,b);
    printf("c=%d", c);
}
```



### 注意

- 在内联函数内不允许用**循环语句**和**switch语句**。如果内联函数内复杂结构，那么执行函数体内代码的时间要比函数调用的开销大。编译器会自动取消内联。
- 内联函数的定义必须出现在内联函数第一次被调用之前
- 实际上，即使没有手工指定`inline`函数，编译器一般还会选择一些代码量较小但使用频繁的函数作为`inline`函数，以此作为**性能优化**的途径之一。同理，即使使用了`inline`，编译器也未必就一定把它作为内联函数处理。



## 物极必反，避免滥用内联函数

**内联函数**，的确省去了函数调用的开销，从而提高函数的执行效率。但是如果执行函数体内代码的时间，相比于函数调用的开销较大，那么效率的收获会很少。另一方面，**每一处内联函数的调用都要替换代码，将使程序的总代码量增大，消耗更多的内存空间**。

**内联函数体内的代码比较长，使用内联将导致内存消耗代价较高。**



## 参考文献

- [C语言inline详细讲解](https://www.cnblogs.com/cnmaizi/archive/2011/01/19/1939686.html)
- [美]Prate,S. C Primer Plus[M]. 第5版. 云巅工作室，译.
- [内联函数](https://zh.wikipedia.org/wiki/%E5%86%85%E8%81%94%E5%87%BD%E6%95%B0)
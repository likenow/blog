## æ ‘è“æ´¾

[toc]



### SD å¡å®‰è£… Ubuntu Server 20.04.3 LTS ç³»ç»Ÿ

#### 1. æ ¼å¼åŒ– TF å¡

SD Card Formatter Version 5.0.1æ ¼å¼åŒ–TFå¡ã€‚è¿™ç§æ–¹å¼åˆ·å¡ï¼Œæ…¢çš„è¦æ­»ã€‚ã€‚ã€‚

<img src="../../assets/image-20211031101859607.png" alt="image-20211031101859607" style="zoom:50%;" />

<img src="../../assets/image-20211031142758009.png" alt="image-20211031142758009" style="zoom:50%;" />

<img src="../../assets/image-20211031142927739.png" alt="image-20211031142927739" style="zoom:50%;" />



#### 2. çƒ§å½•ç³»ç»Ÿ Ubuntu Server 20.04 TS

<img src="../../assets/image-20211031143122549.png" alt="image-20211031143122549" style="zoom:50%;" />

<img src="../../assets/image-20211031143139793.png" alt="image-20211031143139793" style="zoom:50%;" />



<img src="../../assets/image-20211031143250100.png" alt="image-20211031143250100" style="zoom:50%;" />

<img src="../../assets/image-20211031143535573.png" alt="image-20211031143535573" style="zoom:50%;" />

<img src="../../assets/image-20211031143740671.png" alt="image-20211031143740671" style="zoom:50%;" />

<img src="../../assets/image-20211031143839372.png" alt="image-20211031143839372" style="zoom:50%;" />



#### 3 æ’ç”µå¯åŠ¨

##### 3.1 ç½‘çº¿è¿æ¥è·¯ç”±å™¨

é€šè¿‡ `192.168.1.1` ç™»å½•è·¯ç”±å™¨ï¼ŒæŸ¥çœ‹è¿æ¥çš„è®¾å¤‡ï¼Œè·å–åˆ°æ ‘è“æ´¾çš„ ip åœ°å€ï¼Œç„¶å ssh è¿æ¥

<img src="../../assets/image-20211031150617773.png" alt="image-20211031150617773" style="zoom:50%;" />

ä¸Šå›¾æƒ…å†µï¼Œéœ€è¦åˆ é™¤ .ssh/know_host ä¸‹çš„é‚£æ¡è®°å½•ã€‚



<img src="../../assets/image-20211031145038264.png" alt="image-20211031145038264" style="zoom:50%;" />

<img src="../../assets/image-20211031145139933.png" alt="image-20211031145139933" style="zoom:50%;" />

<img src="../../assets/image-20211031153650902.png" alt="image-20211031153650902" style="zoom:50%;" />

##### 3.2 é…ç½®wifi ä¸Šç½‘

å…ˆè¿›å…¥ç½‘ç»œé…ç½®æ‰€åœ¨çš„æ–‡ä»¶å¤¹

```
cd /etc/netplan/
```

åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œä½ èƒ½å‘ç°ä¸€ä¸ªå«`50-cloud-init.yaml`çš„æ–‡ä»¶ï¼Œå°†ä½ è¦é…ç½®çš„å†…å®¹ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç¼–è¾‘å®Œæˆå°±å¯ä»¥äº†ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„é…ç½®ï¼š

```bash
network:
    ethernets:
        eth0:
            dhcp4: false
            addresses: [10.200.12.222/24]
            gateway4: 10.200.12.254
            nameservers:
                    addresses: [10.200.10.1,10.200.10.2]
            option: true
    wifis:
            wlan0:
                    dhcp4: true
                    dhcp6: true
                    optional: true
                    access-points:
                            "cmcc-32a":
                                    password: "password"
    version: 2
```

æ³¨æ„ï¼š

- æ³¨æ„æ ¼å¼

- ç½‘ç»œåå­—åˆ«æé”™äº†

```bash
# å¯ç”¨
sudo netplan --debug apply
```

å¦‚æœé…ç½®æ²¡æœ‰å‡ºé”™çš„è¯ï¼Œç¨åå°±èƒ½ä½¿ç”¨ä½ çš„ wifi æ¨¡å—ä¸Šç½‘é€šè®¯äº†ã€‚

ps. æˆ‘å‘ç° 4B çš„ USB3.0 ä¸‹è¾¹çš„å£ä¼šå½±å“wifiä¿¡å·ğŸ“¶ mdzzz å®³æˆ‘æ‰¾äº†åŠå¤©åŸå› 



### 4 å®‰è£… docker

[Docker install ubuntu](https://docs.docker.com/engine/install/ubuntu/)

å¦‚æœä½ è¿‡å»å®‰è£…è¿‡ dockerï¼Œå…ˆåˆ æ‰:

```bash
sudo apt-get remove docker docker-engine docker.io
```

é¦–å…ˆå®‰è£…ä¾èµ–:

```bash
sudo apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common
```

æ ¹æ®ä½ çš„å‘è¡Œç‰ˆï¼Œä¸‹é¢çš„å†…å®¹æœ‰æ‰€ä¸åŒã€‚ä½ ä½¿ç”¨çš„å‘è¡Œç‰ˆï¼š Debian Ubuntu

ä¿¡ä»» Docker çš„ GPG å…¬é’¥:

```bash
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
```

å¯¹äº amd64 æ¶æ„çš„è®¡ç®—æœºï¼Œæ·»åŠ è½¯ä»¶ä»“åº“:

```bash
sudo add-apt-repository \
   "deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \
   $(lsb_release -cs) \
   stable"
```

å¦‚æœä½ æ˜¯æ ‘è“æ´¾æˆ–å…¶å®ƒ ARM æ¶æ„è®¡ç®—æœºï¼Œè¯·è¿è¡Œ:

```bash
echo "deb [arch=armhf] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \
     $(lsb_release -cs) stable" | \
    sudo tee /etc/apt/sources.list.d/docker.list
```

æœ€åå®‰è£…

```bash
sudo apt-get update
sudo apt-get install docker-ce
```

```bash
# systemctl æ–¹å¼
# å¯åŠ¨        
sudo systemctl start docker
# å®ˆæŠ¤è¿›ç¨‹é‡å¯   
sudo systemctl daemon-reload
# é‡å¯dockeræœåŠ¡   
sudo systemctl restart  docker


# service
# é‡å¯dockeræœåŠ¡  
sudo service docker restart
# å…³é—­
docker service docker stop
```





#### 4.1 å®‰è£… homeassistant

```bash
docker run -d \
  --name homeassistant \
  --privileged \
  --restart=unless-stopped \
  -e TZ=MY_TIME_ZONE \
  -v /PATH_TO_YOUR_CONFIG:/config \
  --network=host \
  ghcr.io/home-assistant/home-assistant:stable
```

<img src="../../assets/image-20211031223631947.png" alt="image-20211031223631947" style="zoom:50%;" />

Ps.

æœŸé—´å¿˜äº†å¯†ç ï¼Œé¦–å…ˆæ‰¾åˆ°

 `sudo docker inspect å®¹å™¨id`

`sudo docker exec -it å®¹å™¨id /bin/bash  `

ç„¶åè¿›è¡Œå‘½ä»¤è¡Œæ“ä½œ åˆ é™¤ `.storage` æ–‡ä»¶å³å¯



#### 4.2 å®‰è£…smb

åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹

```bash
sudo mkdir /opt/smb
sudo chmod -R 777 /opt/smb
```

å®‰è£…smbæœåŠ¡

```bash
sudo apt update
sudo apt install samba -y
```

åˆ›å»ºsmbå¯†ç æ–‡ä»¶

```bash
sudo touch /etc/samba/smbpasswd
```

æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¯†ç 

```bash
sudo smbpasswd -a ubuntu
```

åœ¨`/etc/samba/smb.conf` ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®

```bash
[ubuntu]
   comment = ubuntu
   path = /opt/smb
   writable = yes
   valid user = ubuntu
   available = yes
   create mask = 0777
   directory mask = 0777
   public = yes
```

é‡å¯smbæœåŠ¡

```bash
sudo /etc/init.d/smbd restart
```



```bash
karl@ubuntu:~$ sudo systemctl status nmbd
â— nmbd.service - Samba NMB Daemon
     Loaded: loaded (/lib/systemd/system/nmbd.service; enabled; vendor preset: enabled)
     Active: active (running) since Thu 2021-11-25 12:34:31 CST; 2h 54min ago
       Docs: man:nmbd(8)
             man:samba(7)
             man:smb.conf(5)
   Main PID: 1766 (nmbd)
     Status: "nmbd: ready to serve connections..."
      Tasks: 1 (limit: 9025)
     CGroup: /system.slice/nmbd.service
             â””â”€1766 /usr/sbin/nmbd --foreground --no-process-group

Nov 25 12:34:25 ubuntu systemd[1]: Starting Samba NMB Daemon...
Nov 25 12:34:31 ubuntu systemd[1]: Started Samba NMB Daemon.
```





æŒ‚è½½å¤–æ¥uç›˜

åœ¨`/opt/smb/` ä¸‹æ–°å»ºæ–‡ä»¶å¤¹ `upan1`ï¼Œ ä½œä¸ºæŒ‚è½½ç‚¹

```bash
sudo mkdir  /opt/smb/upan1
sudo chmod 777 -R  /opt/smb/upan1
```

æ¥å…¥ç¡¬ç›˜ï¼ŒæŸ¥çœ‹ç¡¬ç›˜æ˜¯å¦æ¥å…¥æˆåŠŸ

```bash
sudo fdisk -l
```

å¯ä»¥çœ‹åˆ°è®¾å¤‡æŒ‚è½½çš„ä½ç½®ä¸º `/dev/sdc`

- æŒ‚è½½ç¡¬ç›˜

```
sudo mount /dev/sdc /opt/smb/upan1
sudo chmod 777 -R  /opt/smb/upan1
```

<img src="../../assets/image-20211031222542949.png" alt="image-20211031222542949" style="zoom:50%;" />

> #### chmod 777
>
> æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™åˆåˆ†ä¸º3ç§ï¼šåªè¯»ã€åªå†™ã€å¯æ‰§è¡Œã€‚
>
> | æƒé™ | æƒé™æ•°å€¼ | äºŒè¿›åˆ¶   | å…·ä½“ä½œç”¨                                                     |
> | ---- | -------- | -------- | ------------------------------------------------------------ |
> | r    | 4        | 00000100 | readï¼Œè¯»å–ã€‚å½“å‰ç”¨æˆ·å¯ä»¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå½“å‰ç”¨æˆ·å¯ä»¥æµè§ˆç›®å½•ã€‚ |
> | w    | 2        | 00000010 | writeï¼Œå†™å…¥ã€‚å½“å‰ç”¨æˆ·å¯ä»¥æ–°å¢æˆ–ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œå½“å‰ç”¨æˆ·å¯ä»¥åˆ é™¤ã€ç§»åŠ¨ç›®å½•æˆ–ç›®å½•å†…æ–‡ä»¶ã€‚ |
> | x    | 1        | 00000001 | executeï¼Œæ‰§è¡Œã€‚å½“å‰ç”¨æˆ·å¯ä»¥æ‰§è¡Œæ–‡ä»¶ï¼Œå½“å‰ç”¨æˆ·å¯ä»¥è¿›å…¥ç›®å½•ã€‚  |
>
> ä¾ç…§ä¸Šé¢çš„è¡¨æ ¼ï¼Œæƒé™ç»„åˆå°±æ˜¯å¯¹åº”æƒé™å€¼æ±‚å’Œï¼Œå¦‚ä¸‹ï¼š
>
> 7 = 4 + 2 + 1      è¯»å†™è¿è¡Œæƒé™
>
> 5 = 4 + 1             è¯»å’Œè¿è¡Œæƒé™
>
> 4 = 4                   åªè¯»æƒé™
>
> å› æ­¤ï¼Œå¤§å®¶ä¹Ÿå°±æ˜ç™½äº†  chmod  777  filename  å‘½ä»¤çš„å«ä¹‰äº†ã€‚
> 

##### åœ¨Macä¸ŠæŒ‚è½½ä½¿ç”¨smb

- è¿æ¥æœåŠ¡å™¨

<img src="../../assets/image-20211031222007197.png" alt="image-20211031222007197" style="zoom:50%;" />



#### 5 è“ç‰™ âŒ

```bash
# status is not â€runningâ€œ need to start service
systemctl status bluetooth.service
systemctl enable bluetooth
systemctl start bluetooth

bluetoothctl
[bluetooth]# power on
[bluetooth]# scan on
[bluetooth]# scan off
[bluetooth]# devices
[bluetooth]# pair xx
[bluetooth]# connect <dev>
# Set Device to Pair Automatically
[bluetooth]# trust xx
[bluetooth]# remove xx
```



<img src="../../assets/image-20211104112727152.png" alt="image-20211104112727152" style="zoom:50%;" /> 



è“ç‰™ bluetoothctl æŠ¥é”™ `No default controller available` ~~



1. æˆ‘é‡æ–°åˆ·äº†ä¸€ä¸ªpi os fullç‰ˆã€‚ç„¶å å¯åŠ¨äº†æ ‘è“æ´¾ã€‚

2. **æŠŠæˆ‘è“ç‰™è®¾å¤‡åœ¨ç”µè„‘çš„è“ç‰™è¿æ¥åˆ é™¤æ‰ï¼ˆè¿™ä¸€æ­¥å¾ˆé‡è¦ï¼‰**
3. é‡æ–°æ‰§è¡Œä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥äº† âœ…

<img src="../../assets/image-20211116155140006.png" alt="image-20211116155140006" style="zoom:50%;" />



### å‚è€ƒèµ„æ–™

- [æ ‘è“æ´¾ä¹Œé‡‘ç”²å¤–å£³å®‰è£…æ•™ç¨‹](https://www.bilibili.com/video/BV1yE411y79q?from=search&seid=14416903231749814923&spm_id_from=333.337.0.0)
- [Ubuntuå®‰è£… Docker ](https://docs.docker.com/engine/install/ubuntu/)

